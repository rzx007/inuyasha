<!-- d139dfd1-30f8-48b4-85dd-39808c30135d fea6b918-8082-4671-a531-0c85152c03d1 -->
# 复杂组件渲染修复方案 - 简化封装策略

## 核心思路

采用 **封装策略**，但最大化简化配置。

1.  **Wrapper 组件**：创建 `ZTabs` 和 `ZCollapse`，内部处理子组件结构，并暴露与 `item.name` 对应的插槽。
2.  **简化配置**：在 `ComponentMeta` 中仅添加一个布尔标记 `useDynamicSlots`。
3.  **约定优于配置**：当 `useDynamicSlots` 为 true 时，渲染器默认从 `props.items` 遍历生成插槽，插槽名为 `item.name`。

## 详细步骤

### 1. 更新类型定义 (`app/src/types/component.ts`)

在 `ComponentMeta` 中添加可选字段：

```typescript
export interface ComponentMeta {
  // ...
  useDynamicSlots?: boolean // 是否根据 items 属性动态生成插槽
}
```

### 2. 创建封装组件

在 `app/src/components/Materials/layout/` 下创建：

- **ZTabs.vue**:
  ```vue
  <el-tabs v-bind="$attrs">
    <el-tab-pane v-for="item in items" :key="item.name" v-bind="item">
      <slot :name="item.name"></slot>
    </el-tab-pane>
  </el-tabs>
  ```

- **ZCollapse.vue**: 类似逻辑。

### 3. 注册组件

在 `app/src/main.ts` 或通过 `unplugin-vue-components` 确保这些组件可用。鉴于它们是自定义组件，建议在 `main.ts` 全局注册，或者在 `DynamicRenderer` 中导入。

### 4. 更新组件配置 (`layout.ts`)

- **Tabs**: `componentName: 'ZTabs'`, `useDynamicSlots: true`
- **Collapse**: `componentName: 'ZCollapse'`, `useDynamicSlots: true`

### 5. 更新渲染器 (`DynamicRenderer` & `PreviewRenderer`)

增加动态插槽渲染逻辑：

```html
<!-- 动态插槽 -->
<template 
  v-if="componentMeta?.useDynamicSlots && Array.isArray(resolvedProps.items)" 
  v-for="item in resolvedProps.items" 
  :key="item.name" 
  #[item.name]
>
  <!-- 渲染逻辑... -->
</template>
```

## 任务列表

1.  [ ] 更新 `ComponentMeta` 定义，添加 `useDynamicSlots`
2.  [ ] 创建 `ZTabs.vue` 和 `ZCollapse.vue`
3.  [ ] 在 `DynamicRenderer` 和 `PreviewRenderer` 中导入并注册 Wrapper 组件
4.  [ ] 更新 `DynamicRenderer.vue` 和 `PreviewRenderer.vue` 支持 `useDynamicSlots`
5.  [ ] 更新 `layout.ts` 配置

### To-dos

- [ ] 修改 EventBinding 类型定义，将 trigger 改为 string
- [ ] 修改 ComponentMeta 类型定义，添加 triggers 字段
- [ ] 更新基础组件（Button, Input 等）的配置，添加 triggers 定义
- [ ] 重构 ComponentEventsPanel.vue 以支持动态触发器列表
- [ ] 验证 DynamicRenderer 和 PreviewRenderer 的事件处理逻辑
- [ ] 修改 EventBinding 类型定义，将 trigger 改为 string
- [ ] 更新 ComponentMeta 类型定义 (添加 componentName, event, slots, methods)
- [ ] 更新组件配置 (添加 componentName, 完善 triggers/slots)
- [ ] 重构 PreviewRenderer.vue 实现完全动态渲染
- [ ] 重构 DynamicRenderer.vue 实现动态渲染与拖拽插槽集成
- [ ] (可选) 验证组件方法调用机制的可行性
- [ ] 清理 PreviewRenderer 未使用导入
- [ ] 修改 EventBinding 类型定义，将 trigger 改为 string
- [ ] 修改 ComponentMeta 类型定义，添加 triggers 字段
- [ ] 更新基础组件（Button, Input 等）的配置，添加 triggers 定义
- [ ] 重构 ComponentEventsPanel.vue 以支持动态触发器列表
- [ ] 验证 DynamicRenderer 和 PreviewRenderer 的事件处理逻辑
- [ ] 修改 EventBinding 类型定义，将 trigger 改为 string
- [ ] 更新 ComponentMeta 定义，添加 useDynamicSlots
- [ ] 创建 ZTabs.vue 和 ZCollapse.vue
- [ ] 在 DynamicRenderer 和 PreviewRenderer 中导入并注册 Wrapper 组件
- [ ] 更新 DynamicRenderer.vue 和 PreviewRenderer.vue 支持 useDynamicSlots
- [ ] 更新 layout.ts 配置